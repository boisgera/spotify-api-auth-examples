{% extends "base.html" %}
{% block title %}Profile{% endblock %}
{% block content %}
<!-- Response Data -->
<div class="media">
  {% if data.images %}
  <div class="mr-5">
    <img class="media-object" width="150" src="{{ data.images.0.url }}"/>
  </div>
  {% endif %}
  <div class="media-body">
    <h1>Logged in as <i>{{ data.display_name }}</i></h1>
    <dl class="dl-horizontal">
    {% for key, value in data.items() %}
      <dt>{{ key }}</dt><dd>{{ value }}</dd>
    {% endfor %}
    </dl>
  </div>
</div>

<h2>Token Information</h2>
<dl class="dl-horizontal" id="tokens">
  <dt>Access token</dt><dd class="text-truncate">{{ tokens.access_token }}</dd>
  <dt>Refresh token</dt><dd class="text-truncate">{{ tokens.refresh_token }}</dd>
</dl>
{% endblock %}

{% block footer %}
<button type="button" class="btn btn-success btn-xs" onclick="refreshTokens()">Refresh Token</button>
<a href="/logout" class="btn btn-danger btn-xs">Logout</a>

<script>
  function refreshTokens() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        let res_json = JSON.parse(this.responseText)
        document.getElementById("tokens").innerHTML = "<dt>Access token</dt>" +
        "<dd class=\"text-truncate\">" + res_json.access_token + "</dd>" +
        "<dt>Refresh token</dt>" + "<dd class=\"text-truncate\">" +
        res_json.refresh_token + "</dd></dl>";
      }
    };
    xhttp.open("GET", "{{ url_for('refresh') }}", true);
    xhttp.send();
  }
</script>
{% endblock %}